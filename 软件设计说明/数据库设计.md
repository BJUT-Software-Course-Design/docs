# 3.数据库设计
## 3.1ER图设计
![ER图](../images/数据库ER图.png)
## 3.2 表设计
<p style="text-indent:2em;">暂时设计了5个表，具体如下

### 3.2.1 用户表
<p style="text-indent:2em;"> 除开基本的用户名和密码外，用户信息也可包括个人邮箱号，方便后续的操作，如向邮箱发送网站最新信息、教师给学生发送邮件提醒等功能。除此之外，根据需求文档说明，用户拥有三种角色，一种是普通用户，一种是管理员，一种是教师，三种身份拥有的权能不一样。具体设计代码如下：</p>

```
CREATE TABLE 用户 (
    用户ID INT IDENTITY(1,1) PRIMARY KEY,
    用户名 NVARCHAR(50) NOT NULL,
    电子邮件 NVARCHAR(100) NOT NULL UNIQUE,
    密码哈希 NVARCHAR(255) NOT NULL,
    角色 NVARCHAR(10) CHECK (角色 IN ('管理员', '用户', '教师')) DEFAULT '用户',
    创建时间 DATETIME DEFAULT GETDATE()
);
```
### 3.2.2 题目表
<p style="text-indent:2em;"> 每道题目拥有独一的id，除此之外，参考市面上的OJ平台的每道题目的形式，添加标题、描述、输入描述、输出描述、示例输入、示例输出字段，根据我们项目的需求，添加题目的难度字段，方便用户根据自身需求查找对应难度的题目，后续还会加上算法描述字段以让用户查找具体算法对应的题目。实际效果如下，参考市面上的oj平台：

![题目示例](../images/题目示例.png)
具体设计代码如下
```
CREATE TABLE 题目 (
    题目ID INT IDENTITY(1,1) PRIMARY KEY,
    标题 NVARCHAR(100) NOT NULL,
    描述 NVARCHAR(MAX) NOT NULL,
    输入描述 NVARCHAR(MAX) NOT NULL,
    输出描述 NVARCHAR(MAX) NOT NULL,
    示例输入 NVARCHAR(MAX),
    示例输出 NVARCHAR(MAX),
    难度 NVARCHAR(10) CHECK (难度 IN ('简单', '中等', '困难')) DEFAULT '中等',
    创建时间 DATETIME DEFAULT GETDATE()
);
```
### 3.2.3 提交表
<p style="text-indent:2em;"> 该表的功能不仅是把数据给后端评测程序处理，还保存了每一次用户提交的代码和结果等，方便用户查找之前的提交记录以及对比每一次提交的结果，实际效果对应上图中的提交记录tab。具体设计代码如下：

```
CREATE TABLE 提交 (
    提交ID INT IDENTITY(1,1) PRIMARY KEY,
    用户ID INT NOT NULL,
    题目ID INT NOT NULL,
    代码 NVARCHAR(MAX) NOT NULL,
    编程语言 NVARCHAR(10) CHECK (编程语言 IN ('C', 'C++', 'Java', 'Python', '其他')) NOT NULL,
    提交时间 DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (用户ID) REFERENCES 用户(用户ID),
    FOREIGN KEY (题目ID) REFERENCES 题目(题目ID)
);
```
### 3.2.4 评测结果表
<p style="text-indent:2em;"> 该表保存了评测结果，后续通过该表向前端显示对应的结果，如通过、超时、错误答案等。我们也考虑到用户可能会用不同的算法解决问题，为了对比哪种算法更优，该表也保存了执行时间和内存使用量的数据。具体设计代码如下：

```
CREATE TABLE 评测结果 (
    结果ID INT IDENTITY(1,1) PRIMARY KEY,
    提交ID INT NOT NULL,
    评测结论 NVARCHAR(20) CHECK (评测结论 IN ('通过', '错误答案', '超时', '内存超限', '运行时错误', '编译错误', '其他')) NOT NULL,
    执行时间 DECIMAL(10, 3), -- 执行时间（秒）
    内存使用量 INT, -- 内存使用量（KB）
    创建时间 DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (提交ID) REFERENCES 提交(提交ID)
);
```
### 3.2.5 测试用例表
<p style="text-indent:2em;"> 该表保存了每道题目的测试用例的信息。具体设计代码如下：

```
CREATE TABLE 测试用例 (
    测试用例ID INT IDENTITY(1,1) PRIMARY KEY,
    题目ID INT NOT NULL,
    输入数据 NVARCHAR(MAX) NOT NULL,
    输出数据 NVARCHAR(MAX) NOT NULL,
    创建时间 DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (题目ID) REFERENCES 题目(题目ID)
);
```
## 3.3 约束设计
